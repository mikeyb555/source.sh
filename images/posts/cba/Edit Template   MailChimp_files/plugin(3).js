(function(){var k=function(e){require(["mojo/widgets/FileManager","mojo/url","dojo/_base/lang"],function(h,i,k){var g=e.getSelection().getSelectedElement(),l;if(e.getSelection()){var j=e.getSelection().getRanges();j&&(l=j[0])}var f={actions:"select, rename, copy",allowedFileTypes:"image",onSave:function(b){h.hide().then(function(){e.focus();l&&l.select();var d=e.getSelection();if(d)var a=d.getSelectedElement();(d=b.link)&&(-1==d.toLowerCase().indexOf("http://")&&-1==d.toLowerCase().indexOf("https://")&&
-1==d.toLowerCase().indexOf("ftp://")&&-1==d.toLowerCase().indexOf("mailto:")&&0!==d.indexOf("*|")&&0!==d.indexOf("#"))&&(d="http://"+d);var c;a?d&&(c=a.getAscendant("a"),c||(c=e.document.createElement("a"),c.insertBefore(a),a.appendTo(c))):(a=e.document.createElement("img"),d?(c=e.document.createElement("a"),a.appendTo(c),e.insertElement(c)):e.insertElement(a));b.src&&(a.setAttribute("src",b.src),a.setAttribute("data-cke-saved-src",b.src));b.alt?a.setAttribute("alt",b.alt):a.removeAttribute("alt");
b.align?a.setAttribute("align",b.align):a.removeAttribute("align");b.width&&(a.setAttribute("width",b.width),a.setStyle("width",b.width+"px"));b.height&&(a.setAttribute("height",b.height),a.setStyle("height",b.height+"px"));a.removeStyle("margin-top");a.removeStyle("margin-right");a.removeStyle("margin-bottom");a.removeStyle("margin-left");b.styles.marginTop&&a.setStyle("margin-top",b.styles.marginTop+"px");b.styles.marginRight&&a.setStyle("margin-right",b.styles.marginRight+"px");b.styles.marginBottom&&
a.setStyle("margin-bottom",b.styles.marginBottom+"px");b.styles.marginLeft&&a.setStyle("margin-left",b.styles.marginLeft+"px");d?(c.setAttribute("href",d),b.newWindow?c.setAttribute("target","_blank"):c.removeAttribute("target"),c.setAttribute("data-cke-saved-href",d),c.setValue(d)):a.getAscendant("a")&&(c=a.getAscendant("a"),c.remove(!0));b.styles.border&&(a.removeStyle("border-width"),a.removeStyle("border-style"),a.removeStyle("border-color"),"none"!==b.styles.border.style&&(c=a.getAttribute("style"),
c="border: "+b.styles.border.width+"px "+b.styles.border.style+" "+b.styles.border.color+"; "+(c?c.replace(/(\s*)border(.*?):(.*?);(\s*)/gi,""):""),a.setAttribute("style",c)));e.fire("saveSnapshot")})},onSelect:function(b,d){f.src=b;f.name=d;f.width=null;f.height=null;h.showCKForm(f)}};if(g){var j="",m=null,n=g.getAscendant("a");n&&(j=n.getAttribute("href"),m=n.getAttribute("target")||"");k.mixin(f,{src:i.removeProxy(g.getAttribute("src")),width:g.getAttribute("width"),height:g.getAttribute("height"),
alt:g.getAttribute("alt"),align:g.getAttribute("align"),link:j,styles:g.getAttribute("style")});null!=m&&(f.newWindow="_blank"==m);h.showCKForm(f)}else h.show(f)})};CKEDITOR.plugins.add("mcimage",{icons:"mcimage",hidpi:!0,init:function(e){e.addCommand("mcimage",{allowedContent:"img[alt,!src]{border-style,border-width,float,height,margin,margin-bottom,margin-left,margin-right,margin-top,width}",requiredContent:"img[alt,src]",exec:function(e){k(e)},canUndo:!1});e.ui.addButton("MCImage",{label:"File Manager",
command:"mcimage"});e.on("doubleclick",function(h){var i=h.data.element;i.is("img")&&(!i.data("cke-realelement")&&!i.isReadOnly())&&(h.cancel(),k(e))})}})})();