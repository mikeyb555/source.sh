<div class="highlight"><pre>	
<span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">register</span> <span class="no">Employee</span> <span class="k">do</span>

	<span class="c1">#remove unnesecary UI elements and name report</span>
	<span class="n">config</span><span class="o">.</span><span class="n">clear_action_items!</span>
	<span class="n">actions</span> <span class="ss">:all</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
	<span class="n">config</span><span class="o">.</span><span class="n">batch_actions</span> <span class="o">=</span> <span class="kp">false</span>
	<span class="n">menu</span> <span class="ss">:label</span> <span class="o">=&gt;</span> <span class="nb">proc</span><span class="p">{</span> <span class="s2">&quot;Employee Report&quot;</span> <span class="p">}</span>

	<span class="c1">#Narrow filters to useful list</span>
	<span class="n">filter</span> <span class="ss">:FirstName</span>
	<span class="n">filter</span> <span class="ss">:LastName</span>
	<span class="n">filter</span> <span class="ss">:Title</span>
	<span class="n">filter</span> <span class="ss">:City</span>
	<span class="n">filter</span> <span class="ss">:Email</span>

	<span class="c1">#common queries</span>
	<span class="n">scope</span> <span class="ss">:all</span>
	<span class="n">scope</span> <span class="ss">:Calgary</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
		<span class="n">e</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;city = &#39;Calgary&#39;&quot;</span><span class="p">)</span>
	<span class="k">end</span>

	<span class="c1">#Remove XML and JSON from download options</span>
	<span class="n">index</span> <span class="ss">:download_links</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:csv</span><span class="o">]</span><span class="p">,</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">&quot;Employee Report&quot;</span> <span class="k">do</span>
		<span class="n">column</span> <span class="ss">:FirstName</span>
		<span class="n">column</span> <span class="ss">:LastName</span>
		<span class="n">column</span> <span class="ss">:Title</span>
		<span class="c1">#Link ReportsTo to Name</span>
		<span class="n">column</span> <span class="ss">:ReportsTo</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
			<span class="n">m</span> <span class="o">=</span> <span class="no">Employee</span><span class="o">.</span><span class="n">find_by_EmployeeId</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">ReportsTo</span><span class="p">)</span>

			<span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
				<span class="s2">&quot;</span><span class="si">#{</span><span class="n">m</span><span class="o">.</span><span class="n">FirstName</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">m</span><span class="o">.</span><span class="n">LastName</span><span class="si">}</span><span class="s2">&quot;</span>
			<span class="k">else</span>
				<span class="s2">&quot;&quot;</span>
			<span class="k">end</span>
		<span class="k">end</span>
		<span class="n">column</span> <span class="ss">:BirthDate</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
			<span class="n">e</span><span class="o">.</span><span class="n">BirthDate</span><span class="o">.</span><span class="n">to_date</span>
		<span class="k">end</span>
		<span class="n">column</span> <span class="ss">:HireDate</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
			<span class="n">e</span><span class="o">.</span><span class="n">BirthDate</span><span class="o">.</span><span class="n">to_date</span>
		<span class="k">end</span>
		<span class="n">column</span> <span class="ss">:Address</span>
		<span class="n">column</span> <span class="ss">:City</span>
		<span class="n">column</span> <span class="ss">:PostalCode</span>
		<span class="n">column</span> <span class="ss">:Phone</span>
		<span class="n">column</span> <span class="ss">:Fax</span>
		<span class="n">column</span> <span class="ss">:Email</span>
	<span class="k">end</span>

	<span class="n">csv</span> <span class="k">do</span>
		<span class="n">column</span> <span class="ss">:FirstName</span>
		<span class="n">column</span> <span class="ss">:LastName</span>
		<span class="n">column</span> <span class="ss">:Title</span>
		<span class="n">column</span> <span class="ss">:ReportsTo</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
			<span class="n">m</span> <span class="o">=</span> <span class="no">Employee</span><span class="o">.</span><span class="n">find_by_EmployeeId</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">ReportsTo</span><span class="p">)</span>

			<span class="k">if</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
				<span class="s2">&quot;</span><span class="si">#{</span><span class="n">m</span><span class="o">.</span><span class="n">FirstName</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">m</span><span class="o">.</span><span class="n">LastName</span><span class="si">}</span><span class="s2">&quot;</span>
			<span class="k">else</span>
				<span class="s2">&quot;&quot;</span>
			<span class="k">end</span>
		<span class="k">end</span>
		<span class="n">column</span> <span class="ss">:BirthDate</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
			<span class="n">e</span><span class="o">.</span><span class="n">BirthDate</span><span class="o">.</span><span class="n">to_date</span>
		<span class="k">end</span>

		<span class="n">column</span> <span class="ss">:HireDate</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
			<span class="n">e</span><span class="o">.</span><span class="n">BirthDate</span><span class="o">.</span><span class="n">to_date</span>
		<span class="k">end</span>
		<span class="n">column</span> <span class="ss">:Address</span>
		<span class="n">column</span> <span class="ss">:City</span>
		<span class="n">column</span> <span class="ss">:PostalCode</span>
		<span class="n">column</span> <span class="ss">:Phone</span>
		<span class="n">column</span> <span class="ss">:Fax</span>
		<span class="n">column</span> <span class="ss">:Email</span>
	<span class="k">end</span>
<span class="k">end</span>
</pre></div>